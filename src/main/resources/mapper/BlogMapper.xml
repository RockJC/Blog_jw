<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.awei.mapper.BlogMapper">

    <select id="BlogListPage" resultMap="BlogResultMap">
        SELECT
            b.id, b.title, b.recommend, b.published, b.update_time, b.ref_type_id, t.type_id, t.type_name
        FROM
            t_blog b
            inner JOIN t_type t ON b.ref_type_id = t.type_id
        <if test="ew !=null">
            ${ew.customSqlSegment}
        </if>
    </select>
    <select id="BlogUpdateDetail" resultMap="BlogAllMap">
        select
            b.id,b.appreciation,b.commentabled,b.content,b.description,
            b.first_picture,b.flag,b.recommend,b.share_statement,
            b.update_time,b.views,b.ref_type_id,b.ref_user_id,d.type_id,d.type_name,c.tag_id,c.tag_name
        from
            (t_blog b
            inner JOIN t_type d ON b.ref_type_id = d.type_id)
            inner JOIN t_blogtag a ON b.id = a.blog_id
            LEFT JOIN t_tag c ON c.tag_id = a.tag_id
            where b.id = #{id}
    </select>
    <select id="BlogListIndex" resultMap="BlogIndexMap">
        SELECT
            b.id, b.title,b.description,b.first_picture, b.flag, b.published,b.recommend, b.update_time, b.views, b.ref_type_id, t.type_id, t.type_name,u.userid,u.avatar,u.nickname
        FROM
            t_blog b
            inner JOIN t_type t ON b.ref_type_id = t.type_id
            inner JOIN t_user u ON b.ref_user_id = u.userid
        <if test="ew !=null">
                ${ew.customSqlSegment}
        </if>
    </select>
    <select id="BlogListIndexByTime" resultType="com.awei.entity.Blog">
        SELECT *
        FROM t_blog b
        WHERE b.recommend = TRUE
        ORDER BY b.update_time DESC
    </select>
    <resultMap id="BlogResultMap" type="com.awei.entity.Blog">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="recommend" column="recommend"/>
        <result property="published" column="published"/>
        <result property="update_time" column="update_time"/>
        <result property="type_id" column="ref_type_id"/>
        <association property="type" javaType="com.awei.entity.Type">
            <id property="typeid" column="type_id"/>
            <result property="typename" column="type_name"/>
        </association>
    </resultMap>
    <resultMap id="BlogAllMap" type="com.awei.entity.Blog">
        <id property="id" column="id"/>
        <result property="appreciation" column="appreciation"/>
        <result property="commentabled" column="commentabled"/>
        <result property="content" column="content"/>
        <result property="description" column="description"/>
        <result property="firstPicture" column="first_picture"/>
        <result property="flag" column="flag"/>
        <result property="recommend" column="recommend"/>
        <result property="shareStatement" column="share_statement"/>
        <result property="update_time" column="update_time"/>
        <result property="views" column="views"/>
        <result property="type_id" column="ref_type_id"/>
        <result property="user_id" column="ref_user_id"/>
        <association property="type" javaType="com.awei.entity.Type">
            <id property="typeid" column="type_id"/>
            <result property="typename" column="type_name"/>
        </association>
        <collection property="blogtags" ofType="com.awei.entity.Blogtag">
            <association property="tag" javaType="com.awei.entity.Tag">
                <id property="tagid" column="tag_id"/>
                <result property="tagname" column="tag_name"/>
            </association>
        </collection>
    </resultMap>
    <resultMap id="BlogIndexMap" type="com.awei.entity.Blog">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="description" column="description"/>
        <result property="firstPicture" column="first_picture"/>
        <result property="flag" column="flag"/>
        <result property="published" column="published"/>
        <result property="recommend" column="recommend"/>
        <result property="update_time" column="update_time"/>
        <result property="views" column="views"/>
        <result property="type_id" column="ref_type_id"/>
        <association property="type" javaType="com.awei.entity.Type">
            <id property="typeid" column="type_id"/>
            <result property="typename" column="type_name"/>
        </association>
        <association property="user" javaType="com.awei.entity.User">
            <id property="userid" column="userid"/>
            <result property="avatar" column="avatar"/>
            <result property="nickname" column="nickname"/>
        </association>
    </resultMap>
</mapper>
